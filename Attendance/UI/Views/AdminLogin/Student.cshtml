
@{
    ViewBag.Title = "Student";
}




<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script defer src="../js/js.js"></script>
    <!--  CSS -->
    <link rel="stylesheet" href="../css/style.css" />
    <title>learning platform</title>
</head>

<body>


    @*<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <img src="../assets/imgs/جامعة المنوفية.png" class="mr-4" alt="logo" style="width:60px;height:100%;" />
            <a class="navbar-brand" href="#">Learning platform</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item text-center active">
                        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item text-center mx-2">
                        <a class="nav-link" href="#">Standard</a>
                    </li>
                    <li class="nav-item text-center mx-2">
                        <a class="nav-link" href="#">Staff</a>
                    </li>
                    <li class="nav-item text-center mx-2">
                        <a class="nav-link" href="#">Feedback</a>
                    </li>
                    <li class="nav-item text-center mx-2">
                        <a class="nav-link" href="#">Admin panel</a>
                    </li>
                    <li class="nav-item text-center mx-2">
                        <a class="nav-link" href="#">Contact us</a>
                    </li>

                </ul>
            </div>
        </nav>*@

    <div class="container-fluid">
        <div class="row">
            <div id="show" class="h-100 col-lg-3 col-md-4 text-center p-0 overflow-hidden d-md-block text-white border-right col-sm-12">
                <nav class="nav navbar-expand-md navbar-light bg-light">
                    <button class="navbar-toggler w-100" type="button" data-toggle="collapse" data-target="#navbarNavDropdown2" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span> Panel
                    </button>
                    <!--SideBar using partailview-->
                    @Html.Partial("_SideBarTeacherPanal")
                </nav>

            </div>
            <div class="col-lg-9 col-md-8 col-sm-12 justify-content-center">
                <div id="content" class="container text-center col-12 overflow-auto">
                    <!-- content .... import content here(homepage.html,feedback.html,adminlogin.html and any component)-->
                    <!-- end content -->
                    <div class="col-lg-8 offset-lg-2 border-danger border p-5 my-5 shadow">
                        <h2 class="my-4 text-danger">Add New Student</h2>
                        <div class="row">
                            <label>Select Level:</label>
                            <select class="form-control my-2" id="ddlDropdownlistLevelStudent">
                                <!--<option value="0" selected>Select standard</option>
                                <option value="1">1st std</option>
                                <option value="2">2nd std</option>-->
                            </select>
                            <div><p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentnlevel">Level Name is Required!</p></div><br />
                            <br /><label>Select Class:</label>
                            <select class="form-control my-2" id="ddlDropdownlistClassStudent">
                                @*<option value="0" selected>Select Division</option>
                                    <option value="1">A6Y54</option>
                                    <option value="2">B5G46</option>*@
                            </select>
                            <div><p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentclass">Class Name is Required!</p></div>
                            <div class="col-12 my-2"><input type="button" class="btn btn-danger w-25" value="Select" id="btnselectCount"></div>

                            <!-- information -->
                            <div class="w-100 my-3">
                                <h4 class="text-primary text-left">
                                    Total seat: <span class="text-dark" id="txttotalseat">0</span>
                                </h4>
                                <h4 class="text-primary text-left">
                                    Total admitted: <span class="text-dark" id="txttotaladmit">0</span>
                                </h4>
                                <h4 class="text-primary text-left">
                                    Remaining students: <span class="text-dark" id="txtremainingstudent">0</span>
                                </h4>
                            </div>
                            <form class="my-3 row w-100">
                                <!-- when you add student to server show this alert(replace d-none with d-block) -->
                                <!-- end of alert -->
                                <!--<input type="number" class="form-control my-1" placeholder="RollNo" value="">-->
                                <input type="text" class="form-control my-1" placeholder="Student name" value="" id="txtStudentName">
                                <p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentname">Student Name is Required!</p>
                                <input type="number" class="form-control my-1" placeholder="Mobile" value="" id="txtStudentMobile">
                                <p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentmobile">Mobile is Required!</p>
                                <input type="email" class="form-control my-1" placeholder="Email" value="" id="txtStudentEmail">
                                <p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentemail">Email is Required!</p>
                                <p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentinvalidemail">Invalid Email!</p>
                                <input type="date" class="form-control" id="txtStudentDate">
                                <p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentdate">Date is Required!</p>
                                <input type="text" class="form-control my-1" placeholder="Address" value="" id="txtStudentAddress">
                                <p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentaddress">Address is Required!</p>
                                <input type="text" class="form-control my-1" placeholder="City" value="" id="txtStudentCity">
                                <p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentcity">City is Required!</p>
                                <!--<input type="email" class="form-control my-1" placeholder="Pincode" value="">
                                <label for="photo">Photo:</label>-->
                                <input type="file" class="form-control-file" name="" id="txtStudentPhoto">
                                <p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentfile">File Name is Required!</p>
                                <input type="email" class="form-control my-1" placeholder="Username" value="" id="txtStudentUsername">
                                <p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentusername">Username is Required!</p>
                                <input type="password" class="form-control my-1" placeholder="Password" value="" id="txtStudentPassword">
                                <p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentpassword">Password is Required!</p>
                                <input type="password" class="form-control my-1" placeholder="Confirm Password" value="" id="txtStudentConfirmPassword">
                                <p style="text-align:center;color:#e60000;font-family:Arial;" id="validstudentconfirmpassword">Confirm Password is Wrong!</p>
                                <div class="w-100 my-2">
                                    <div class="alert w-100 alert-primary d-none" id="alertstudentadd">Student added successfully</div>
                                    <input class="btn btn-danger" type="button" id="btnAddnewStudent" value="Add Student">
                                </div>

                            </form>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>
    <footer class="card-footer bg-dark text-white text-center fixed-bottom">
        Designer/Magdy Elsayyad
    </footer>




    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="../js/jquery.slim.js"></script>
    <script src="../js/bootstrap.bundle.min.js"></script>


</body>

</html>

<script>
    $(document).ready(function () {
        $('#validstudentnlevel').hide();
        $('#validstudentclass').hide();
        $('#validstudentname').hide();
        $('#validstudentmobile').hide();
        $('#validstudentemail').hide();
        $('#validstudentdate').hide();
        $('#validstudentaddress').hide();
        $('#validstudentcity').hide();
        $('#validstudentfile').hide();
        $('#validstudentusername').hide();
        $('#validstudentpassword').hide();
        $('#validstudentconfirmpassword').hide();
        $('#validstudentinvalidemail').hide();
        $('#alertstudentadd').hide();
        DropdownlistLevel();
        DropdownlistClass();
        $('#btnAddnewStudent').click(function () {
            $('#validstudentnlevel').hide();
            $('#validstudentclass').hide();
            $('#validstudentname').hide();
            $('#validstudentmobile').hide();
            $('#validstudentemail').hide();
            $('#validstudentdate').hide();
            $('#validstudentaddress').hide();
            $('#validstudentcity').hide();
            $('#validstudentfile').hide();
            $('#validstudentusername').hide();
            $('#validstudentpassword').hide();
            $('#validstudentconfirmpassword').hide();
            $('#validstudentinvalidemail').hide();
            AddnewStudent();
            Add();
        })
        $('#btnselectCount').click(function () {
            $('#validstudentnlevel').hide();
            $('#validstudentclass').hide();
            CountSeat();
            CountStudent();
            //subtract();
            SubtractSeatandStudent();
        })
    })

    //load data level in dropdownlist
    function DropdownlistLevel() {
        $.ajax({
            url: "/AdminLogin/DropdownlistLevelStudent",
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                var html = '';
                html += '<option value=-1>Choice Level</option>'
                $.each(result, function (key, item) {
                    html += '<option value=' + item.LevelID + '>';
                    html += item.LevelName + '</option>';
                });
                $('#ddlDropdownlistLevelStudent').html(html);
            }
        });
    }

    //load data classes in dropdownlist
    function DropdownlistClass() {
        $.ajax({
            url: "/AdminLogin/DropdownlistClassStudent",
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                var html = '';
                html += '<option value=-1>Choice Class</option>'
                $.each(result, function (key, item) {
                    html += '<option value=' + item.ClassID + '>';
                    html += item.ClassName + '</option>';
                });
                $('#ddlDropdownlistClassStudent').html(html);
            }
        });
    }

    //Count Student in this level
    function CountStudent() {
        var droplevel = $('#ddlDropdownlistLevelStudent').val();
        var dropclass = $('#ddlDropdownlistClassStudent').val();
        $.ajax({
            url: "/AdminLogin/CountStudent?LevelID=" + droplevel + "&ClassID=" + dropclass,
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                if (droplevel == -1 || droplevel == undefined) {
                    $('#validstudentnlevel').show();
                }
                else if (dropclass == -1 || dropclass == undefined) {
                    $('#validstudentclass').show();
                }
                else {
                    if (result != null) {
                        $('#txttotaladmit').text(result);
                    }
                    else {
                        //$('#validstudentinvalidemail').slideDown(500).delay(2000).slideUp(2000);
                        alert("Error")
                    }
                }
            }
        });
    }

    //Count Seat in Class
    function CountSeat() {
        var droplevel = $('#ddlDropdownlistLevelStudent').val();
        var dropclass = $('#ddlDropdownlistClassStudent').val();
        $.ajax({
            url: "/AdminLogin/CountSeat?LevelID=" + droplevel + "&ClassID=" + dropclass,
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                if (droplevel == -1 || droplevel == undefined) {
                    $('#validstudentnlevel').show();
                }
                else if (dropclass == -1 || dropclass == undefined) {
                    $('#validstudentclass').show();
                }
                else {
                    if (result != null) {
                        $('#txttotalseat').text(result);
                    }
                    else {
                        //$('#validstudentinvalidemail').slideDown(500).delay(2000).slideUp(2000);
                        alert("Error")
                    }
                }
            }
        });
    }

    //Subtract Seat and Number of student
    function SubtractSeatandStudent() {
        var droplevel = $('#ddlDropdownlistLevelStudent').val();
        var dropclass = $('#ddlDropdownlistClassStudent').val();
        $.ajax({
            url: "/AdminLogin/SubtractSeatandStudent?LevelID=" + droplevel + "&ClassID=" + dropclass,
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                if (droplevel == -1 || droplevel == undefined) {
                    $('#validstudentnlevel').show();
                }
                else if (dropclass == -1 || dropclass == undefined) {
                    $('#validstudentclass').show();
                }
                else {
                    if (result != null) {
                        $('#txtremainingstudent').text(result);
                    }
                    else {
                        //$('#validstudentinvalidemail').slideDown(500).delay(2000).slideUp(2000);
                        alert("Error")
                    }
                }
            }
        });
    }


    //function subtract() {
    //   var seat= $('#txttotalseat').text();
    //    var student = $('#txttotaladmit').text();
    //    var subtract = seat - student;
    //    $('#txtremainingstudent').text(subtract);
    //}



    //Add new student
    function AddnewStudent() {
        var id = $('#hdnTeacherID').val();
        var droplevel = $('#ddlDropdownlistLevelStudent').val();
        var dropclass = $('#ddlDropdownlistClassStudent').val();
        var name = $('#txtStudentName').val();
        var mobile = $('#txtStudentMobile').val();
        var email = $('#txtStudentEmail').val();
        var date = $('#txtStudentDate').val();
        var address = $('#txtStudentAddress').val();
        var city = $('#txtStudentCity').val();
        var photo = $('#txtStudentPhoto').val();
        var username = $('#txtStudentUsername').val();
        var password = $('#txtStudentPassword').val();
        var confirmpassword = $('#txtStudentConfirmPassword').val();
        if (droplevel == -1 || droplevel == undefined) {
            $('#validstudentnlevel').show();
        }
        else if (dropclass == -1 || dropclass == undefined) {
            $('#validstudentclass').show();
        }
        else if (name == "" || name == undefined) {
            $('#validstudentname').show();
        }
        else if (mobile == "" || mobile == undefined) {
            $('#validstudentmobile').show();
        }
        else if (email == "" || email == undefined) {
            $('#validstudentemail').show();
        }
        else if (date == "" || date == undefined) {
            $('#validstudentdate').show();
        }
        else if (address == "" || address == undefined) {
            $('#validstudentaddress').show();
        }
        else if (city == "" || city == undefined) {
            $('#validstudentcity').show();
        }
        else if (photo == "" || photo == undefined) {
            $('#validstudentfile').show();
        }
        else if (username == "" || username == undefined) {
            $('#validstudentusername').show();
        }
        else if (password == "" || password == undefined) {
            $('#validstudentpassword').show();
        }
        else if (confirmpassword != password || confirmpassword == undefined || confirmpassword == "") {
            $('#validstudentconfirmpassword').show();
        }
        else {
            $.ajax({
                url: "/AdminLogin/AddStudent?LevelID=" + droplevel + "&ClassID=" + dropclass + "&StudentName=" + name + "&StudentMobile=" + mobile + "&StudentEmail=" + email + "&StudentDate=" + date + "&Address=" + address + "&City=" + city + "&Photo=" + photo + "&UserName=" + username + "&Password=" + password + "&TeacherID=" + id,
                type: "POST",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    if (result == "Success") {
                        $('#alertstudentadd').slideDown(2000).delay(2000).slideUp(2000);
                        ClearData();
                    }
                    else {
                        $('#validstudentinvalidemail').slideDown(500);
                    }
                }
            });
        }

    }

    //upload file
    function Add() {
        if (window.FormData == undefined)
            alert("Error: FormData is undefined");

        else {
            var fileUpload = $("#txtStudentPhoto").get(0);
            var files = fileUpload.files;

            var fileData = new FormData();

            fileData.append(files[0].name, files[0]);

            $.ajax({
                url: '/AdminLogin/uploadFile',
                type: 'post',
                datatype: 'json',
                contentType: false,
                processData: false,
                async: false,
                data: fileData,
                success: function (response) {
                    alert(response);
                }
            });
        }

    }

    //Clear Data in textbox
    function ClearData() {
        $('#ddlDropdownlistLevelStudent').val(-1);
        $('#ddlDropdownlistClassStudent').val(-1);
        $('#txtStudentName').val("");
        $('#txtStudentMobile').val("");
        $('#txtStudentEmail').val("");
        $('#txtStudentDate').val(-1);
        $('#txtStudentAddress').val("");
        $('#txtStudentCity').val("");
        $('#txtStudentPhoto').val("");
        $('#txtStudentUsername').val("");
        $('#txtStudentPassword').val("");
        $('#txtStudentConfirmPassword').val("");
    }

</script>


